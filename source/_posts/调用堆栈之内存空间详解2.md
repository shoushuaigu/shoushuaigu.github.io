---
title: 调用堆栈(2)--内存空间详解
date: 2021-02-18 15:16:24
tags:
    - 调用堆栈
categories: 
            - Js深入
---
### 内存空间和调用栈的关系
以v8引擎为例,V8引擎在chrome和node中负责解析和执行js,其简化来说包括两部分:Heap(用于分配内存),call stack(执行栈);
也就是说内存空间和执行栈是并列的
![](v8.png)
### 内存空间都包含什么
- 栈: 存放变量
- 堆: 存放复杂对象
- 池: 一般也归为栈,存放常量(常量池)

### 数据怎么在内存空间中储存
- 基础数据类型: 存放在栈内存中(不包括闭包)
    - 此类型数据占有固定大小内存空间,按值直接访问
    - null,undefined,Boolean,string,number,symbol
- 引用类型/(闭包): 存放在堆内存
    - 此类型数据所占空间不定,会随数据变化
    - 但内存地址大小固定,因此内存地址储存在栈空间中
    - 访问此类型是通过内存地址来找到具体值,称为引用访问
    - object(array function Set(es6) Map(es6))

![](栈堆内存中的数据.png)
在计算机的数据结构中，栈比堆的运算速度快
```js
var a = 20;
var b = a;
b = 30;
// 这时a的值是多少？    20

// ---------------
var a = { name: '前端开发' }
var b = a;
b.name = '进阶';
// 这时a.name的值是多少     '进阶'

// ---------------
var a = { name: '前端开发' }
var b = a;
a = null;   // 改变了a的引用地址
// 这时b的值是多少      { name: '前端开发' }

// ---------------
var a = {n: 1};
var b = a;
a.x = a = {n: 2};
a.x 	// 这时 a.x 的值是多少      undefined
b.x 	// 这时 b.x 的值是多少      {n: 2}
/*
 解: 
 .优先级高于=;a.x是undefined,即a=b={n:1,x:undefined}
 从右向左运算,a={n:2}后,即改变了原来a的引用,和b已经没关联了
 a.x=a即a.x={n:2},此时的a.x是引用数据{n:1,x:undefined}中的x,
 数据变为{n:1,x:{n:2}},此时b能访问到,a已经访问不到
*/
```

### 内存空间的管理
js内存生命周期包括
- 分配所需内存
- 使用分配到的内存(读,写)
- 释放,归还内存(垃圾回收)
---
内存回收,泄漏见下篇内存机制
